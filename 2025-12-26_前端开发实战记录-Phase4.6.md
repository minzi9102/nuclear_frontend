# 搜索与按钮样式开发总结

## 一、核心功能演进回顾

整个搜索体系的构建经历了一个从"基础功能"到"准生产级交互"的过程：

- **UI 标准化 (Standardization)**：
  - 统一将搜索框、搜索按钮、高级搜索按钮及新建按钮的 `size` 设为 `large`（40px 高度），确保视觉对齐。
  - 采用 Flex 布局管理顶部操作栏，利用 `flex: 1` 让输入框自适应拉伸，而按钮通过 `flex-shrink: 0` 保持固定宽度。

- **搜索逻辑增强 (Search Logic)**：
  - 模糊搜索：利用 Strapi v5 的 `$containsi` 操作符实现不区分大小写的姓名匹配。
  - 高级搜索：构建了基于 `filters` 的组合查询，支持性别、生日区间及既往治疗（JSON 数组）的精确筛选。

- **响应式适配 (Responsive Design)**：
  - 布局转型：弃用 `el-table`，改用 `el-row`/`el-col` 栅格卡片，提升在手机端的展示效率。
  - 空间收纳：将复杂的高级搜索表单收纳进 `el-drawer`（抽屉），确保移动端首屏简洁。

## 二、遇到的问题与解决方法 (Troubleshooting)

在样式调整与功能集成过程中，主要攻克了以下难点：

### 1. UI 布局与高度对齐问题

| 现象 (Symptom) | 根本原因 (Root Cause) | 解决方案 (Solution) |
|---------|---------|---------|
| 搜索框与按钮高度错位 | Element Plus 组件未显式声明 `size`，导致不同组件回退到不同的默认高度。 | 统一在 Template 中为 `el-input` 和 `el-button` 设置 `size="large"`。 |
| 侧边栏挤压搜索区域 | 移动端未正确隐藏 PC 侧边栏，导致有效显示宽度被压缩。 | 修正 CSS 媒体查询类名，在 768px 以下强制隐藏 `.aside` 并改用抽屉导航。 |
| 高度塌陷/菜单消失 | Vue 根节点 `#app` 默认高度由内容撑开，导致侧边栏无法撑满全屏。 | 在 `App.vue` 中强制设置 `html, body, #app { height: 100% }`。 |

### 2. 移动端溢出与挤压问题

| 现象 (Symptom) | 根本原因 (Root Cause) | 解决方案 (Solution) |
|---------|---------|---------|
| 搜索组件超出屏幕右侧 | 在窄屏下，多个固定宽度的按钮强制并排，导致 `el-input` 宽度被挤压至 0。 | 在媒体查询中使用 `flex-direction: column` 将布局重组，输入框与按钮组分行显示。 |
| 高级搜索抽屉内容切断 | 抽屉 `size="380px"` 超过部分旧款手机的屏幕宽度。 | 将抽屉宽度设为响应式，移动端强制使用 `size="100%"` 或 `size="90%"`。 |
| 日期选择器撑破布局 | `el-date-picker` 范围模式在移动端有最小宽度限制，无法自适应。 | 使用 `:deep()` 穿透组件样式，强制设置 `width: 100% !important` 并缩小内部字体。 |

### 3. 交互逻辑与后端适配

| 现象 (Symptom) | 根本原因 (Root Cause) | 解决方案 (Solution) |
|---------|---------|---------|
| 变量未定义报错 (2304) | 在实现高级搜索时，变量名拼写不一致（如多打了 `Search` 关键字）。 | 统一变量名为 `advancedSearchForm` 并重启 TS Server 刷新缓存。 |
| 搜索结果不准确 | 逻辑中未处理"顶部搜索框"与"高级搜索框"的优先级。 | 在 `fetchData` 中实现逻辑合并：优先使用高级搜索字段，为空则回退至通用关键词。 |
| JSON 字段无法筛选 | Strapi v5 对 JSON 类型（如 `past_treatments`）需要特定的 `$contains` 语法。 | 确保后端 Schema 字段名为大写 `Images` 或准确的下划线格式，前端按需构建 `$contains` 对象。 |

## 三、核心开发经验总结 (Key Takeaways)

- **单一事实来源 (SSOT)**：通过 `constants` 统一定义治疗部位等映射表，避免了在搜索和展示时出现硬编码导致的逻辑不一致。

- **移动优先 (Mobile First)**：对于医疗 CMS 这种需要现场使用的系统，弹窗和抽屉必须使用百分比宽度，且复杂组件（如日期范围）需做深度样式降级。

- **防御性解包**：Strapi v5 的响应结构较深，处理 `res.data.data` 时必须通过可选链或逻辑判断防止页面白屏。
