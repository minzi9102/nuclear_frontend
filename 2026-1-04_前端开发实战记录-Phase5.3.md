Dev Context Snapshot [2026/01/04 18:45]
1. 核心任务与状态

    当前目标: 完成图片上传组件的性能/体验优化，以及详情页影像画廊的交互重构。

    当前状态: 已完成 (代码已应用，待真机验证)。

    关键文件:

        src/components/ImageUploader/index.vue: [重构] 引入队列串行处理、防抖逻辑、虚线框交互及列表顺序调整。

        src/components/PatientDetailDialog/TreatmentImages.vue: [重构] 弃用 Carousel，实现"主图+缩略图"布局、手势滑动及 CSS 推拉动画。

2. 本次会话变动 (Changelog)

    [重构] ImageUploader 性能优化:

        引入 pendingQueue + while 循环串行处理图片，配合 await sleep(50) 让出主线程，防止 UI 卡死。

        增加 debounceTimer (100ms) 解决批量选择时剩余数量显示跳变问题。

    [交互] ImageUploader UI:

        空状态改为虚线框 (Dashed Box)，绑定 @click 触发隐藏 input。

        缩略图列表中将 上传按钮 (+) 移至首位。

    [新增] TreatmentImages 画廊:

        实现自定义画廊：主图 (absolute 定位) + 底部缩略图流。

        集成 Touch 事件 (touchstart/touchend)，阈值 40px，支持左右滑动切换。

        实现 <Transition> 动画 (slide-left/slide-right)，根据索引变化方向动态切换过渡效果。

        优化导航按钮样式：深色半透明背景，贴边显示，减少遮挡。

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 在真机 (iPad/Mobile) 上进行极限压力测试（一次性上传 12-20 张图），验证队列逻辑是否有效避免崩溃。

    TODO: 验证 TreatmentImages 在 iOS Safari 上的滑动体验，确认 touch-action: pan-y 是否有效阻止页面滚动冲突。

    RISK: 低端设备在 Canvas 连续重绘时可能仍有发热或轻微卡顿，需监控 submitAll 时的内存波动。

4. 环境与依赖上下文

    Tech Stack: Vue 3 (Composition API), TypeScript, Element Plus, Compressor.js.

    Key Config:

        Upload Limit: 12 images (Hardcoded check).

        CSS: 使用了 v-deep 和 Vue 3 <Transition> 组件。