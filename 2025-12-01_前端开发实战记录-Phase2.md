# **📝 前端开发实战记录 \- Phase 2 (Part 1)：登录页开发与兼容性修复**

日期：2025-12-01  
当前阶段：Phase 2 \- 通用布局与登录页开发  
任务目标：构建用户登录界面，配置路由守卫，并解决浏览器兼容性问题。

## **1\. 🏗️ 功能实现记录**

### **1.1 目录结构规划**

为了规范页面管理，在 src 目录下建立了视图文件夹：

* src/views/login/：存放登录页相关组件。  
* src/views/layout/：存放主布局（侧边栏、顶部导航）组件。

### **1.2 开发登录页面 (src/views/login/index.vue)**

使用 Element Plus 构建了卡片式登录界面，实现了以下逻辑：

* **UI 组件**：使用 \<el-card\>, \<el-form\>, \<el-input\> 构建界面。  
* **数据交互**：  
  * 收集用户名 (identifier) 和密码。  
  * 调用 request.post('/auth/local') 发送请求。  
* **登录成功处理**：  
  * 将后端返回的 JWT Token 存入 localStorage。  
  * 将用户信息存入 localStorage。  
  * 使用 router.push('/') 跳转至主页。

### **1.3 路由配置更新 (src/router/index.ts)**

更新了路由规则以支持登录流程：

* **定义路由**：  
  * /login：指向登录页组件。  
  * /：暂时重定向到 /login（防止首页白屏）。  
* **全局前置守卫 (beforeEach)**：  
  * 检查本地是否有 Token。  
  * 如果未登录且访问非登录页，强制跳转回 /login。

## **2\. 🐛 遇到的问题与解决方案 (Troubleshooting)**

在开发过程中遇到了 TypeScript 类型导入限制和 Firefox 浏览器兼容性两个主要问题。

### **🔴 问题一：Vue Router 类型导入报错**

**报错信息**：  
“RouteRecordRaw”是一种类型，必须在启用 "verbatimModuleSyntax" 时使用仅类型导入进行导入。ts(1484)  
原因分析：  
Vite 和现代 TypeScript 配置开启了严格的模块语法检查。RouteRecordRaw 是 Vue Router 的类型定义接口，不是运行时代码，不能与功能函数（如 createRouter）混用同一个 import 语句。  
✅ 解决方案：  
在 src/router/index.ts 中拆分导入语句：  
// ❌ 错误写法  
import { createRouter, createWebHistory, RouteRecordRaw } from 'vue-router'

// ✅ 正确写法  
import { createRouter, createWebHistory } from 'vue-router' // 导入功能  
import type { RouteRecordRaw } from 'vue-router'            // 导入类型

### **🔴 问题二：Firefox 显示 "Upgrade Required"**

**报错信息**：  
打开 http://localhost:5173/login 时显示白屏或文本 Upgrade Required (HTTP 状态码 426)。  
原因分析：  
这是 Vite 开发服务器 (Dev Server) 与 Firefox 浏览器在 Windows 环境下的兼容性问题。

* Firefox 对 IPv6/IPv4 的解析机制较严格。  
* 导致 Vite 的 WebSocket 热更新连接（HMR）握手失败。  
* Edge/Chrome 浏览器通常能自动降级处理，所以未报错。

✅ 解决方案：  
强制 Vite 开发服务器绑定到 IPv4 地址 (127.0.0.1)。  
修改 vite.config.ts：  
export default defineConfig({  
  plugins: \[vue()\],  
  server: {  
    host: '127.0.0.1', // 强制指定 Host  
    port: 5173,  
  }  
})

*注意：修改配置后必须重启终端* (Ctrl \+ C \-\> npm run dev) *才能生效。*

## **3\. 🎉 阶段成果**

* ✅ 登录页面 UI 渲染正常。  
* ✅ 路由跳转逻辑正常（未登录自动跳回登录页）。  
* ✅ Firefox 浏览器兼容性问题解决，登录http://127.0.0.1:5173/ ，页面正常显示。
