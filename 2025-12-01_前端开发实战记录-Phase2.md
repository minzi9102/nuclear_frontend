# **📝 前端开发实战记录 - Phase 2：核心页面框架构建**

日期：2025-12-01  
阶段名称：Phase 2 - 核心页面框架构建  
任务目标：完成用户登录流程、搭建系统主布局（侧边栏+顶部导航）、配置嵌套路由，确保系统"骨架"搭建完毕。

---

## **1. 🏗️ 核心功能实现记录**

### **1.1 目录结构规划**

为了规范页面管理，建立了标准的视图层级：

* `src/views/login/`：存放登录页组件。
* `src/views/layout/`：存放系统主框架组件（侧边栏、顶栏）。
* `src/views/home/`：存放系统首页（仪表盘）组件。

### **1.2 登录流程开发**

**UI 实现**：使用 `<el-card>` 构建卡片式登录界面，集成 Element Plus 表单验证。

**逻辑实现**：
* 调用 POST /auth/local 接口进行身份验证。
* 关键动作：登录成功后，将 jwt (Token) 和 user (用户信息) 分别存入 localStorage。
* 跳转逻辑：验证通过后自动跳转至 / (即首页)。

### **1.3 主布局 (Layout) 开发**

**布局结构**：采用经典的后台管理布局（左侧固定菜单 + 顶部导航 + 右侧内容区）。

**组件使用**：使用 `<el-container>`, `<el-aside>`, `<el-header>`, `<el-main>` 构建整体框架。

**侧边栏菜单**：
* 配置 `<el-menu router>` 模式，实现点击菜单项自动跳转路由。
* 引入 `@element-plus/icons-vue` 图标库增强视觉体验。

**顶部导航**：实现了"退出登录"功能（清除 Token 并跳转回登录页）。

### **1.4 路由系统升级（嵌套路由）**

将路由从"单层结构"升级为"嵌套结构（Parent-Child）"：

* **`/login`**：独立路由，全屏显示登录页。
* **`/`（Layout）**：
  * 作为父路由，加载 Layout 组件（相框）。
  * **`/home`**：作为子路由，加载 Home 组件（画），显示在 Layout 的 `<router-view />` 中。

**路由守卫**：全局拦截无 Token 的访问，强制重定向至 `/login`。

---

## **2. 🐛 遇到的问题与解决方案 (Troubleshooting)**

### **🔴 问题一：TypeScript 类型导入报错**

**报错信息**：  
"RouteRecordRaw"是一种类型，必须在启用 "verbatimModuleSyntax" 时使用仅类型导入进行导入。

**原因**：  
Vite 默认开启严格模式，TS 不允许将"类型定义"和"功能函数"混写在同一个 import 语句中。

**✅ 解决方案**：  
在 `src/router/index.ts` 中拆分导入语句：

````typescript
import { createRouter, createWebHistory } from 'vue-router' // 导入功能
import type { RouteRecordRaw } from 'vue-router'            // 导入类型
````

---

### **🔴 问题二：Firefox 浏览器无法打开（Upgrade Required）**

**报错信息**：  
页面白屏或显示 Upgrade Required (HTTP 426)，但在 Edge/Chrome 下正常。

**原因**：  
Vite 开发服务器默认监听 `localhost`，而 Windows 下的 Firefox 对 IPv6/IPv4 解析机制较为严格，导致 WebSocket 热更新连接握手失败。

**✅ 解决方案**：  
修改 `vite.config.ts`，强制开发服务器绑定到 IPv4 地址：

````typescript
export default defineConfig({
  plugins: [vue()],
  server: {
    host: '127.0.0.1', // 强制使用 IPv4
    port: 5173,
  }
})
````

*注意：修改配置后必须重启终端*（Ctrl + C → `npm run dev`）*才能生效。*

---

### **🔴 问题三：登录后界面缺失菜单（高度塌陷）**

**现象**：  
登录后只显示了首页内容，左侧菜单栏和顶部导航栏消失（或高度为 0）。

**原因**：  
Vue 的根节点 `#app` 和 `body` 默认高度由内容撑开。如果内容很少，容器高度不足 100%，导致 Flex 布局的侧边栏无法撑满屏幕。

**✅ 解决方案**：  
在 `src/App.vue` 中强制设置全局高度：

````css
html, body, #app {
  height: 100%; /* 关键：必须占满屏幕 */
  margin: 0;
  padding: 0;
  width: 100%;
}
````

---

## **3. 🎉 阶段总结**

至此，**Phase 2 圆满完成**！✅

现在的系统具备了：

* **安全性**：进门要查"工牌"（Token）。
* **稳定性**：解决了浏览器兼容问题。
* **美观性**：拥有了标准的后台管理界面框架。

**🚀 下一步（Phase 3）**：进入最核心的业务开发——对接患者管理 (Patients) 模块，实现真实的增删改查。
