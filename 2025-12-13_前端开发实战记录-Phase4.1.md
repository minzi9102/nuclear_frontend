# 📝 局域网部署操作全流程 (Operation Log)

## 1. 前端服务配置 (Vite)

**目标**：允许外部设备访问你的开发服务器，而不仅仅是本机。

**操作**：修改 `vite.config.ts`。

**代码**：

```typescript
server: {
  host: '0.0.0.0', // 监听所有网卡接口
  port: 5173,
  open: true
}
```

---

## 2. 确定服务器地址

**目标**：找到开发机在局域网中的"门牌号"。

**操作**：在终端运行 `ipconfig` (Windows) 或 `ifconfig` (Mac/Linux)。

**结果**：获取 IPv4 地址（例如：192.168.1.5）。

---

## 3. 环境变量更新 (Environment Variables)

**目标**：让运行在手机上的前端代码知道去哪里找后端 API。

**操作**：修改 `.env` 文件。

**重要变更**：将 `localhost` 替换为局域网 IP。

```properties
# ❌ 旧值: http://localhost:1337
# ✅ 新值: http://192.168.1.5:1337
VITE_API_URL=http://192.168.1.5:1337
```

**注意**：修改后必须重启 Vite (`npm run dev`)。

---

## 4. 代码硬编码清理

**目标**：消除代码中残留的死地址。

**操作**：检查 `src/views/treatments/index.vue` 及其他组件。

**变更**：将所有手动拼接的 `'http://localhost:1337'` 字符串替换为 `import.meta.env.VITE_API_URL`。

---

## 🔧 遇到的问题与解决方案 (Troubleshooting)

在本次部署过程中，我们主要解决了两个核心问题：

| 现象 (Symptom) | 根本原因 (Root Cause) | 解决方案 (Solution) |
|---|---|---|
| **手机能访问网页，但图片显示 "FAILED"** | **代码硬编码 (Hardcoding)**。<br/><br/>虽然 API 地址改了，但列表页的 `getThumbnailUrl` 函数里依然写死了 `'http://localhost:1337'`。手机访问时，localhost 指向的是手机自己，当然找不到图片。 | **统一使用环境变量**：<br/><br/>将拼接逻辑改为 `return url.startsWith('http') ? url : ${import.meta.env.VITE_API_URL}${url}` |
| **手机无法访问网页，或无法加载图片** | **防火墙拦截 (Firewall Blocking)**。<br/><br/>Windows 防火墙默认可能会阻止 Node.js 接受来自外部网络的连接请求（特别是 1337 和 5173 端口）。 | **配置防火墙白名单**：<br/><br/>进入 Windows 安全中心 -> 允许应用通过防火墙 -> 勾选 Node.js JavaScript Runtime 的"专用"和"公用"权限。 |
| **API 请求失败** | **环境变量未生效**。<br/><br/>修改了 `.env` 文件，但浏览器依然请求旧地址。 | **重启服务**：<br/><br/>Vite 在启动时才会读取 `.env`。修改后必须执行 `Ctrl+C` 并重新运行 `npm run dev`。 |

---

## 🧠 核心知识点总结

### Localhost vs 局域网 IP

- **Localhost (127.0.0.1)**：只有电脑自己能访问自己。
- **局域网 IP (192.168.x.x)**：同一 WiFi 下的所有设备都能访问。
- **前端是运行在客户端的**：当手机打开网页时，JS 代码是在手机浏览器里跑的。如果你写 localhost，手机就会去连接手机本身，而不是你的电脑。

### 环境变量的重要性

- **永远不要在代码里写死 URL (Hardcoding)**。使用 `VITE_API_URL` 可以让你在不做任何代码修改的情况下，适应本机开发、局域网测试和上线生产环境。

---

## 🚀 总结

你的项目现在已经具备了非常高的完成度和工程化水平！接下来，你可以随时把手机递给别人演示你的 Hospital CMS 了！
