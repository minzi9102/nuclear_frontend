Dev Context Snapshot [2025/12/30 17:35]
1. 核心任务与状态

    当前目标: 实现科研级图片语义化重命名 (PinyinName_Gender_DOB_Date_Target) 以适配未来 NAS 归档。

    当前状态: 前端逻辑已完成 (已解决中文丢失问题)，待后端 NAS/MinIO 配置。

    关键文件:

        src/components/TreatmentCreateDialog.vue: 集成 pinyin-pro，实现双路（锁定/搜索）患者对象获取与文件名拼接。

        src/components/ImageUploader/index.vue: 修改 submitAll 接收 namingPrefix 参数。

        src/api/upload.ts: 修改 uploadFile 支持在 FormData 中传入自定义文件名。

2. 本次会话变动 (Changelog)

    [新增] 引入依赖 pinyin-pro，解决 Strapi 后端自动清洗中文文件名导致信息丢失的问题。

    [重构] 文件名生成策略：

        姓名: 中文 -> 拼音 (CamelCase, LiSi)。

        性别: 直接使用后端原始值 (male -> Male)，移除冗余翻译。

        格式: ${Pinyin}_${Gender}_${DOB}_${Date}_${Target}。

    [修复] TreatmentCreateDialog.vue 中 handleSubmit 逻辑：增加了 else 分支，确保在搜索模式下能通过 patientOptions 获取完整 currentPatient 对象。

    

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 下一阶段需部署 MinIO (Windows) + 配置 Strapi AWS-S3 Provider 以实现 NAS 存储落地。

    NOTE: 当前文件上传后，Strapi 仍会自动追加 Hash 后缀 (如 _a1b2c.jpg)，这是核心机制，不影响排序归档，已确认接受此行为。

4. 环境与依赖上下文

    Tech Stack: Vue 3, TypeScript, Strapi v5, Element Plus.

    Dependencies: pinyin-pro (新增), dayjs.

    Logic Context:

        上传组件 (ImageUploader) 必须在 submitAll 被调用时才真正上传。

        文件名重命名依赖前端预处理，而非后端插件扩展。