Dev Context Snapshot [2025-12-29]
1. 核心任务与状态

    当前目标: 重构患者列表卡片 (PatientCard) UI，优化移动端交互与视觉层级。

    当前状态: ✅ 代码已生成 (Ready to Apply)

    关键文件:

        src/views/patients/index.vue: 修改 Header/Body/Footer 结构，引入下拉菜单。

2. 本次会话变动 (Changelog)

    [UI重构] el-card Header:

        移除: 独立的年龄 Tag。

        新增: el-dropdown (图标: MoreFilled, 旋转90度)，包含"编辑"与"删除"选项。

        逻辑: 添加 @click.stop 阻止冒泡，避免触发卡片详情跳转。

    [UI重构] el-card Body:

        修改: 将年龄信息 (N岁) 移至生日字段旁显示。

    [UI重构] el-card Footer:

        移除: 原有的"编辑/删除"按钮组。

        保留: 仅保留"新建治疗记录"按钮，样式改为 plain。

    [Style]: 新增 .text-danger 样式，使下拉菜单中的删除项显示为红色。

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 将提供的 <template>, <script> (imports), <style> 代码片段应用到 src/views/patients/index.vue。

    Note: 需验证移动端点击"三个点"图标的触控区域是否足够灵敏。

4. 环境与依赖上下文

    Tech Stack: Vue 3, TypeScript, Element Plus (Icons: @element-plus/icons-vue)

    Config: 依赖 MoreFilled 图标组件。

Dev Context Snapshot [2025-12-29]
1. 核心任务与状态

    当前目标: 优化 TreatmentCreateDialog 组件的移动端适配、弹窗定位及表单默认值逻辑。

    当前状态: 已完成 (代码已生成，待应用)。

    关键文件:

        src/components/TreatmentCreateDialog.vue: 全量重构 template (布局/属性) 与 script (响应式逻辑/默认值)。

2. 本次会话变动 (Changelog)

    [重构] 响应式布局:

        引入 window.innerWidth 监听，计算 isMobile (<768px)。

        el-form: 移动端 label-position 设为 top，PC 端设为 right。

        el-col: 字段布局调整为 :xs="24" :sm="12" (手机端强制换行)。

    [优化] 弹窗体验 (UI/UX):

        el-dialog: 宽度调整为 :width="isMobile ? '90%' : '600px'"。

        el-dialog: 顶部距离调整为 :top="isMobile ? '4vh' : '5vh'" (解决 PC/Mobile 弹窗位置过低问题)。

        CSS: 放弃了 overflow-y: auto 的内部滚动方案，回归 Element Plus 默认页面滚动逻辑。

    [修改] 表单默认值:

        target: 默认值由 'face' 改为 '' (强制用户选择)。

        duration: 默认值设为 1，步长 1，精度 0 (仅允许整数)。

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 将最终生成的完整代码覆盖至 src/components/TreatmentCreateDialog.vue。

    NOTE: 用户明确决定删除用于强制内部滚动的全局 <style> 块，保留 scoped 样式。

4. 环境与依赖上下文

    Tech Stack: Vue 3 (Composition API), TypeScript, Element Plus.

    Utils: 使用原生 window.addEventListener('resize') 实现响应式判断，未引入 @vueuse/core。

Dev Context Snapshot [2025-12-29]
1. 核心任务与状态

    当前目标: 优化 PatientDetailDialog 组件在移动端的显示，解决治疗记录折叠面板头部信息拥挤溢出的问题。

    当前状态: 已完成 (代码待应用)

    关键文件:

        src/components/PatientDetailDialog.vue: 重构 <el-collapse-item> 的 #title 插槽结构与样式。

2. 本次会话变动 (Changelog)

    [重构] 治疗记录头部布局 (Header Layout):

        从单行 Flex 布局改为 上下分层 (Column) 布局。

        Row 1: treatmentNo (序号) + target (部位 Tag, style: plain)。

        Row 2: duration (时长) + date (日期)。

    [UI/UX] 视觉优化:

        增加 padding: 8px 0 扩大点击区域。

        第二行辅助信息采用灰色小字 (#9ca3af)，增强层级感。

    [新增] 字段修饰:

        日期字段前增加静态文本前缀 "记录时间：" 。

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 将提供的 Template 代码块（#title 部分）与 CSS 代码块（.collapse-header-wrapper 等）应用到 src/components/PatientDetailDialog.vue。

4. 环境与依赖上下文

    Tech Stack: Vue 3, TypeScript, Element Plus (Icons: <Timer />).

    Dependencies: 依赖 ../constants/treatment 中的 TREATMENT_TARGET_MAP 进行字典映射。

Dev Context Snapshot [2025-12-29]
1. 核心任务与状态

    当前目标: 重构 views/treatments/index.vue，废弃局部表单逻辑，集成统一的 TreatmentCreateDialog 组件。

    当前状态: ✅ 已完成 (代码已生成并应用)

    关键文件:

        src/views/treatments/index.vue: 全量替换了 <script> 和 <template>，接入了通用创建弹窗。

2. 本次会话变动 (Changelog)

    [重构] 组件复用:

        引入 TreatmentCreateDialog 替代原有的 el-dialog 表单。

        移除了 ImageUploader、createTreatment、getPatientList 等局部引入。

        删除了 formData、rules、patientOptions 等冗余状态。

    [逻辑] 交互流转:

        handleCreate 改为调用 treatmentCreateRef.value?.open() (无参调用，启用非锁定搜索模式)。

        监听 @success 事件触发 fetchData 刷新列表。

    [数据] 字段同步:

        确保了 duration (治疗时长) 字段在新建流程中的传递已被封装在子组件内，外部无需关心 Payload 组装。

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 验证在 views/treatments/index.vue 打开弹窗时，"关联患者"搜索框是否正常工作（非锁定状态）。

    TODO: 检查新建记录后，列表页的 "时长" 和 "部位" 字段是否正确渲染。

4. 环境与依赖上下文

    Tech Stack: Vue 3 (Composition API), TypeScript, Element Plus

    Dependencies: 依赖 src/components/TreatmentCreateDialog.vue

    Config: 沿用 VITE_API_URL 环境变量。

Dev Context Snapshot [2025-12-29]
1. 核心任务与状态

    当前目标: views/treatments/index.vue 移动端适配与 TypeScript 类型修复

    当前状态: 已完成 (代码已生成并修正)

    关键文件:

        src/views/treatments/index.vue: 实现 Table/Card 响应式切换，修正 getThumbnailUrl 参数签名。

2. 本次会话变动 (Changelog)

    [新增] 响应式布局:

        引入 isMobile (阈值 768px) 及 resize 监听。

        PC 端保持 <el-table>，移动端渲染 .mobile-card 列表。

        顶部搜索栏在移动端改为垂直堆叠 (Column Layout)。

    [优化] 分页逻辑: 移动端强制简化为 prev, pager, next 布局。

    [修复] TS 类型错误:

        报错: item.Images[0] 可能为 undefined 导致无法赋值给 StrapiMedia。

        解决: 修改 getThumbnailUrl 签名，接受 StrapiMedia | undefined 并内部处理空值。

3. 挂起的任务与已知问题 (CRITICAL)

    TODO: 在真机环境验证移动端卡片列表的滚动流畅度及图片预览 (Preview) 的层级显示。

    TODO: 检查新建弹窗 (TreatmentCreateDialog) 在移动端触发时的宽度适配情况。

4. 环境与依赖上下文

    Tech Stack: Vue 3 (Composition API), TypeScript, Element Plus (Icons: Timer, Calendar, Plus, etc.)

    Config: 依赖 VITE_API_URL 环境变量。
