# 开发记录：新建治疗记录组件集成

## 1. 功能概述

本次开发的核心目标是实现**"治疗记录"的快捷创建**，并将其复用到系统的不同层级中。

- **组件名称**： TreatmentCreateDialog.vue
- **涉及页面**： 
  - views/patients/index.vue (病人列表)
  - components/PatientDetailDialog.vue (病人详情)
- **核心能力**： 支持"锁定病人"模式（从病人入口进入）和"搜索病人"模式（独立入口进入，暂未启用但预留逻辑），支持多图上传、部位选择及治疗时长记录。

## 2. 核心开发步骤

### 第一步：组件封装 (TreatmentCreateDialog.vue)

**状态管理**： 使用 isPatientLocked 状态位。
- 如果调用 open({ documentId, Name }) 传入了参数，则锁定输入框，禁止修改病人。
- 如果未传参，则允许通过 API 远程搜索病人（searchPatients）。

**表单设计**：
- 包含：关联患者、治疗部位、治疗时长、影像上传（复用 ImageUploader）、手动序号。
- 使用了 nextTick 清除表单校验残留。

**对外暴露**： 使用 defineExpose({ open }) 供父组件调用，遵循统一的交互规范。

**事件通信**： 提交成功后触发 emit('success')，通知父组件刷新数据。

### 第二步：详情页集成 (PatientDetailDialog.vue)

**入口位置**： 放置在弹窗顶部的 Header 区域（右侧），提高了操作的可见性。

**数据流转**：
- 点击"新建治疗记录" -> 调用子组件 open()，传入当前 patientData。
- 子组件提交成功 -> 触发 @success。
- 父组件捕获事件 -> 重新调用 open(currentDocumentId) 刷新详情数据，更新"共 N 次"标签和时间轴列表。

### 第三步：列表页集成 (views/patients/index.vue)

**入口位置**： 每个病人卡片的底部操作栏（Footer）。

**数据流转**：
- 点击卡片按钮 -> 获取当前行数据 row -> 调用子组件 open()。
- 提交成功 -> 触发 @success -> 调用 fetchData() 刷新整个列表（更新卡片上的统计数据）。
